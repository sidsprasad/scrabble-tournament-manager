<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../partials/head %>
</head>
<body>
<header>
    <% include ../partials/header %>
</header>

<style type="text/css">
    .form-control, .btn {
        min-height: 38px;
        border-radius: 2px;
    }
    .btn {        
        font-size: 15px;
        font-weight: bold;
    }

    #make-admin-form {
        width: 340px;
        margin: 15px auto;
    }
    #make-admin-form form {
        margin-bottom: 15px;
        background: #f7f7f7;
        box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
        padding: 30px;
    }
    #make-admin-form h2 {
        margin: 0 0 15px;
    }

    #create-tournament-form {
        width: 340px;
        margin: 15px auto;
    }
    #create-tournament-form form {
        margin-bottom: 15px;
        background: #f7f7f7;
        box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
        padding: 30px;
    }
    #create-tournament-form h2 {
        margin: 0 0 15px;
    }
</style>

<main style="padding: 15px;">
    <div class="jumbotron">
        <h1 id="username" style="text-transform:capitalize;"></h1>
        <p>Welcome!</p>
    </div>
    <div class="jumbotron" id="admin-tools-section">
        <h3><u>Admin Tools</u></h3>
        <div id="admin-tools">
            <br>
            <button id="create-tournament-button">Create Tournament</button>
            <div id="handle-admin-button-section">
                <br><br>
                <button id="make-admin-button">Make Admin</button>
                <button id="remove-admin-button">Remove Admin</button>
            </div>
            &nbsp;
        </div>

        <div id="create-tournament-form">
            <form>
                <h2 class="text-center">Create Tournament</h2>       
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Tournament Name [Max: 32 chars]" required="required" id="new-tournament-name">
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" placeholder="Number of rounds" required="required" id="new-tournament-rounds">
                </div>
                <div class="form-group">
                    Start Date: <input type="date" class="form-control" required="required" id="new-tournament-start-date">
                </div>
                <div class="form-group">
                    End Date: <input type="date" class="form-control" required="required" id="new-tournament-end-date">
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-primary btn-block" id="create-tournament-submit-button">Submit</button>
                </div>   
            </form>
            
            <p class="text-center"><button type="button" class="btn btn-secondary btn-block open-admin-tools">Back</button></p>
        </div>

        <div id="make-admin-form">
            <form>
                <h2 class="text-center">Make Admin</h2>       
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Player ID (username)" required="required" id="new-admin-username">
                </div>
                <div class="form-group">
                    <select id="new-admin-level" style="width: 100%; text-align: center;">
                        <option value="">Select Level</option>
                        <option value="1">Level 1</option>
                        <option value="2">Level 2</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-primary btn-block" id="make-admin-submit-button">Submit</button>
                </div>   
            </form>
            
            <p class="text-center"><button type="button" class="btn btn-secondary btn-block open-admin-tools">Back</button></p>
        </div>

    </div>
</main>

<footer>
    <% activeButton = "profile" %>
    <% include ../partials/bottom-bar %>
</footer>

    <% include ../scripts/global-scripts %>

    <script type="text/javascript">

        $("#create-tournament-submit-button").click(function () {
            var name = $("#new-tournament-name").val();
            var rounds = $("#new-tournament-rounds").val();
            var startDate = $("#new-tournament-start-date").val();
            var endDate = $("#new-tournament-end-date").val();
            params = {name: name, gamesPerPair: rounds, startDate: startDate, endDate: endDate};
            if(!name || !rounds || !startDate || !endDate) {
                alert("Please enter all fields.");
            } else {
                postRequest('<%=domainName%>/api/leagues/createLeague',params,function (data) {

                    $("#make-admin-form").hide();
                    $("#create-tournament-form").hide();

                    $("#admin-tools").show();

                    alert("Created!");
                });
            }
        });


        $("#make-admin-submit-button").click(function () {
            var newUsername = $("#new-admin-username").val();
            var newAdminLevel = $("#new-admin-level").val();
            params = {username: newUsername, adminLevel: newAdminLevel};

            if(!newUsername || !newAdminLevel) {
                alert("Please enter all fields.");
            } else {
                postRequest('<%=domainName%>/api/profile/makeAdmin',params,function (data) {

                    $("#make-admin-form").hide();
                    $("#create-tournament-form").hide();

                    $("#admin-tools").show();

                    alert("Made admin!");
                });
            }
        });


        $(".open-admin-tools").click(function () {
            $("#make-admin-form").hide();
            $("#create-tournament-form").hide();

            $("#admin-tools").show();
        });

        $("#make-admin-button").click(function () {
            $("#admin-tools").hide();
            $("#make-admin-form").show();
        });

        $("#create-tournament-button").click(function () {
            $("#admin-tools").hide();
            $("#create-tournament-form").show();
        });

        $(function() {
            var adminLevel = getCookie('adminLevel');
            var username = getCookie('username')
            if(!getCookie("token")) {
                requestFail({logout: true});
            }

            $('#username').html( username );

            if(adminLevel<2) {
                $("#handle-admin-button-section").hide();
            }
            if(adminLevel<1) {
                $("#create-tournament-button").hide();
            }
            $("#make-admin-form").hide();
            $("#create-tournament-form").hide();

            $("#admin-tools").show();
            
        });
    </script>
</body>
</html>